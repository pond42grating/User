<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pending User Approval</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>
</head>
<body>
  <h1>Pending Users</h1>
  <div id="pending-users"></div> <!-- This is where the output will be displayed -->

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAXZgxM6PU-T3D2811KnBszblRWju7rv1Y",
      authDomain: "dws-management.firebaseapp.com",
      projectId: "dws-management",
      storageBucket: "dws-management.firebasestorage.app",
      messagingSenderId: "23827231923",
      appId: "1:23827231923:web:97141b6d19c7cd109d2cc6",
      measurementId: "G-L14GLJDYW7"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Function to fetch users with isApproved: false
    async function fetchPendingUsers() {
      try {
        const usersRef = db.collection('Users');
        const querySnapshot = await usersRef.where('isApproved', '==', false).get();
        const pendingUsersDiv = document.getElementById('pending-users');
        pendingUsersDiv.innerHTML = ''; // Clear any previous content

        if (querySnapshot.empty) {
          pendingUsersDiv.innerHTML = '<p>No pending users found.</p>';
          return;
        }

        querySnapshot.forEach(doc => {
          const userData = doc.data();
          const userDiv = document.createElement('div');
          userDiv.innerHTML = `
            <p><strong>Email:</strong> ${userData.email}</p>
            <button onclick="approveUser('${doc.id}')">Approve</button>
          `;
          pendingUsersDiv.appendChild(userDiv);
        });
      } catch (error) {
        console.error('Error fetching pending users:', error);
      }
    }

    // Function to update a user's approval status
    async function approveUser(userId) {
      try {
        await db.collection('Users').doc(userId).update({ isApproved: true });
        alert(`User ${userId} is now approved.`);
        fetchPendingUsers(); // Refresh the list
      } catch (error) {
        console.error('Error approving user:', error);
      }
    }

    // Fetch pending users on page load
    fetchPendingUsers();
  </script>
</body>
</html>