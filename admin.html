<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"></script>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1, h2 {
            color: #333;
        }

        .button {
            padding: 10px 15px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        .button:hover {
            background-color: #0056b3;
        }

        .settings {
            position: absolute;
            top: 10px;
            right: 20px;
        }

        .dropdown {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            right: 0;
            top: 40px;
            z-index: 1000;
        }

        .dropdown a {
            display: block;
            padding: 10px;
            text-decoration: none;
            color: black;
        }

        .dropdown a:hover {
            background-color: #f0f0f0;
        }

        .section {
            display: none;
            margin-top: 20px;
        }

        .visible {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <h1>Admin Panel</h1>

    <!-- Settings Dropdown -->
    <div class="settings">
        <button class="button" onclick="toggleSettings()">Settings</button>
        <div class="dropdown" id="settings-dropdown">
            <a href="adminProfile.html">Admin Profile</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </div>

    <!-- Section Navigation -->
    <div>
        <button class="button" onclick="showSection('approval')">User Approval</button>
    </div>

    <!-- Sections -->
    <!-- User Approval Section -->
    <div id="approval" class="section">
        <h2>User Approval</h2>
        <div id="approval-list">
            <p>Loading unapproved users...</p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAXZgxM6PU-T3D2811KnBszblRWju7rv1Y",
            authDomain: "dws-management.firebaseapp.com",
            projectId: "dws-management",
            storageBucket: "dws-management.firebasestorage.app",
            messagingSenderId: "23827231923",
            appId: "1:23827231923:web:97141b6d19c7cd109d2cc6",
            measurementId: "G-L14GLJDYW7"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore(app);

        // Toggle Settings Dropdown
        function toggleSettings() {
            const dropdown = document.getElementById("settings-dropdown");
            dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        }

        // Logout Function
        function logout() {
            auth.signOut().then(() => {
                alert("Logged out successfully!");
                window.location.href = "index.html";
            }).catch((error) => {
                alert("Logout failed: " + error.message);
            });
        }

        // Show Section
        function showSection(sectionId) {
            const sections = document.querySelectorAll(".section");
            sections.forEach((section) => {
                section.classList.remove("visible");
            });
            document.getElementById(sectionId).classList.add("visible");
        }

        // User Approval Section
        db.collection("Users")
          .where("isApproved", "==", false) // Filter for unapproved users
          .onSnapshot((snapshot) => {
              const approvalList = document.getElementById("approval-list");
              approvalList.innerHTML = ""; // Clear the list before re-rendering

              if (snapshot.empty) {
                  approvalList.innerHTML = "<p>No unapproved users found.</p>";
                  return;
              }

              snapshot.forEach((doc) => {
                  const data = doc.data();

                  approvalList.innerHTML += `
                      <div style="margin-bottom: 10px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
                          <p><strong>Email:</strong> ${data.email}</p>
                          <p><strong>Last Login:</strong> ${new Date(data.lastLogin).toLocaleString()}</p>
                          <button class="button" onclick="approveUser('${doc.id}')">Approve</button>
                          <button class="button" style="background-color: red;" onclick="rejectUser('${doc.id}')">Reject</button>
                      </div>
                  `;
              });
          });

        // Approve User Function
        function approveUser(userId) {
            db.collection("Users")
              .doc(userId)
              .update({ isApproved: true })
              .then(() => {
                  alert("User approved successfully!");
              })
              .catch((error) => {
                  alert("Error approving user: " + error.message);
              });
        }

        // Reject User Function
        function rejectUser(userId) {
            if (confirm("Are you sure you want to reject this user? This action cannot be undone.")) {
                db.collection("Users")
                  .doc(userId)
                  .delete()
                  .then(() => {
                      alert("User rejected and deleted successfully!");
                  })
                  .catch((error) => {
                      alert("Error rejecting user: " + error.message);
                  });
            }
        }
    </script>
</body>
</html>