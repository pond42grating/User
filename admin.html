<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f1f5f9;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #4caf50;
            color: white;
            padding: 10px 20px;
        }
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: white;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            padding: 10px;
            z-index: 1;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .section {
            margin: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .section h2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0;
        }
        .badge {
            background: red;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }
        .user-item:last-child {
            border-bottom: none;
        }
        .buttons {
            display: flex;
            gap: 10px;
        }
        button {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-approve { background: green; color: white; }
        .btn-reject, .btn-clear { background: red; color: white; }
        .btn-clear { background: #2196f3; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
</head>
<body>
    <div class="navbar">
        <h1>Admin Dashboard</h1>
        <div class="dropdown">
            <button>Settings</button>
            <div class="dropdown-content">
                <a href="adminprofile.html">Admin Profile</a>
                <a href="#" id="logout">Logout</a>
            </div>
        </div>
    </div>

    <!-- Sections -->
    <div class="section" id="approvalRequests">
        <h2>Approval Requests <span class="badge" id="approvalCount">0</span></h2>
        <div id="approvalList">Loading...</div>
    </div>

    <div class="section" id="onlineUsers">
        <h2>Online Users <span class="badge" id="onlineCount">0</span></h2>
        <div id="onlineList">Loading...</div>
    </div>

    <div class="section" id="userLogs">
        <h2>User Logs <span class="badge" id="logsCount">0</span></h2>
        <div>
            <input type="date" id="fromDate"> to <input type="date" id="toDate">
            <button class="btn-clear" id="clearLogs">Clear Logs</button>
        </div>
        <div id="logsList">Loading...</div>
    </div>

    <div class="section" id="approvedUsers">
        <h2>Approved Users <span class="badge" id="approvedCount">0</span></h2>
        <div id="approvedList">Loading...</div>
    </div>

    <div class="section" id="holdBlockedUsers">
        <h2>Hold/Blocked Users <span class="badge" id="holdBlockedCount">0</span></h2>
        <div id="holdBlockedList">Loading...</div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAXZgxM6PU-T3D2811KnBszblRWju7rv1Y",
            authDomain: "dws-management.firebaseapp.com",
            projectId: "dws-management",
            storageBucket: "dws-management.firebaseapp.com",
            messagingSenderId: "23827231923",
            appId: "1:23827231923:web:97141b6d19c7cd109d2cc6",
            measurementId: "G-L14GLJDYW7"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.getAuth(app);
        const db = firebase.getFirestore(app);

        // Logout Function
        document.getElementById('logout').addEventListener('click', () => {
            firebase.signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        });

        const fetchApprovalRequests = async () => {
            const approvalList = document.getElementById("approvalList");
            let approvalCount = 0;
            const approvalSnap = await firebase.getDocs(firebase.collection(db, "Users"));
            approvalSnap.forEach((doc) => {
                if (!doc.data().isApproved) {
                    approvalCount++;
                    approvalList.innerHTML += `<div class="user-item">${doc.id} 
                    <div class="buttons">
                        <button class="btn-approve">Approve</button> 
                        <button class="btn-reject">Reject</button>
                    </div></div>`;
                }
            });
            document.getElementById("approvalCount").textContent = approvalCount;
        };

        const fetchOnlineUsers = async () => {
            const onlineList = document.getElementById("onlineList");
            let onlineCount = 0;
            const onlineSnap = await firebase.getDocs(firebase.collection(db, "Users"));
            onlineSnap.forEach((doc) => {
                if (doc.data().isOnline) {
                    onlineCount++;
                    const lastLogin = new Date(doc.data().lastLogin);
                    const now = new Date();
                    const diffHours = Math.round((now - lastLogin) / (1000 * 60 * 60));
                    onlineList.innerHTML += `<div class="user-item">${doc.id} - Online for ${diffHours} hours</div>`;
                }
            });
            document.getElementById("onlineCount").textContent = onlineCount;
        };

        const fetchUserLogs = async () => {
            const logsList = document.getElementById("logsList");
            let logsCount = 0;
            const logsSnap = await firebase.getDocs(firebase.collection(db, "Logs"));
            logsSnap.forEach((doc) => {
                logsCount++;
                logsList.innerHTML += `<div class="user-item">${doc.data().activity} at ${doc.data().timestamp}</div>`;
            });
            document.getElementById("logsCount").textContent = logsCount;
        };

        const fetchApprovedUsers = async () => {
            const approvedList = document.getElementById("approvedList");
            let approvedCount = 0;
            const approvedSnap = await firebase.getDocs(firebase.collection(db, "Users"));
            approvedSnap.forEach((doc) => {
                if (doc.data().isApproved) {
                    approvedCount++;
                    approvedList.innerHTML += `<div class="user-item">${doc.id}
                    <div class="buttons">
                        <button class="btn-approve">Hold</button> 
                        <button class="btn-reject">Block</button>
                    </div></div>`;
                }
            });
            document.getElementById("approvedCount").textContent = approvedCount;
        };

        const fetchHoldBlockedUsers = async () => {
            const holdBlockedList = document.getElementById("holdBlockedList");
            let holdBlockedCount = 0;
            const holdBlockedSnap = await firebase.getDocs(firebase.collection(db, "Users"));
            holdBlockedSnap.forEach((doc) => {
                if (doc.data().status === "Hold" || doc.data().status === "Blocked") {
                    holdBlockedCount++;
                    holdBlockedList.innerHTML += `<div class="user-item">${doc.id} - ${doc.data().status}</div>`;
                }
            });
            document.getElementById("holdBlockedCount").textContent = holdBlockedCount;
        };

        const clearLogs = async () => {
            const fromDate = document.getElementById("fromDate").value;
            const toDate = document.getElementById("toDate").value;
            if (!fromDate || !toDate) {
                alert("Please select both dates.");
                return;
            }

            const logsSnap = await firebase.getDocs(firebase.collection(db, "Logs"));
            logsSnap.forEach((doc) => {
                const logDate = new Date(doc.data().timestamp);
                if (logDate >= new Date(fromDate) && logDate <= new Date(toDate)) {
                    firebase.deleteDoc(firebase.doc(db, "Logs", doc.id));
                }
            });
            alert("Logs cleared successfully.");
            fetchUserLogs();
        };

        document.getElementById("clearLogs").addEventListener("click", clearLogs);

        fetchApprovalRequests();
        fetchOnlineUsers();
        fetchUserLogs();
        fetchApprovedUsers();
        fetchHoldBlockedUsers();
    </script>
</body>
</html>