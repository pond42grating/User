<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <style>
    /* Add styles for your dashboard here */
    body {
      font-family: Arial, sans-serif;
      background-color: #f3f6f9;
    }
    .container {
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    .header {
      background-color: #4CAF50;
      color: white;
      padding: 15px;
      text-align: center;
    }
    .card {
      background-color: white;
      padding: 20px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .card h3 {
      margin-top: 0;
    }
    .button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>Admin Dashboard</h1>
  </div>

  <div class="container">
    <div class="card">
      <h3>Approval Requests <span id="approval-count">0</span></h3>
      <p>No approval requests found.</p>
    </div>

    <div class="card">
      <h3>Online Users <span id="online-count">0</span></h3>
      <div id="online-users"></div>
    </div>

    <div class="card">
      <h3>User Logs <span id="logs-count">0</span></h3>
      <div id="user-logs"></div>
      <button class="button" id="clear-logs">Clear Logs</button>
    </div>

    <div class="card">
      <h3>Approved Users <span id="approved-count">0</span></h3>
      <div id="approved-users"></div>
    </div>

    <div class="card">
      <h3>Hold/Blocked Users <span id="blocked-count">0</span></h3>
      <div id="blocked-users"></div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js"></script>
  
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAXZgxM6PU-T3D2811KnBszblRWju7rv1Y",
      authDomain: "dws-management.firebaseapp.com",
      projectId: "dws-management",
      storageBucket: "dws-management.firebasestorage.app",
      messagingSenderId: "23827231923",
      appId: "1:23827231923:web:97141b6d19c7cd109d2cc6",
      measurementId: "G-L14GLJDYW7"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Fetching Online Users
    function fetchOnlineUsers() {
      const onlineUsersRef = db.collection('Users').where('isOnline', '==', true);
      onlineUsersRef.get().then(snapshot => {
        let onlineUsersHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          onlineUsersHTML += `<p>${data.username} - Online for ${data.onlineDuration} mins</p>`;
        });
        document.getElementById('online-users').innerHTML = onlineUsersHTML;
        document.getElementById('online-count').textContent = snapshot.size;
      });
    }

    // Fetching User Logs
    function fetchUserLogs() {
      const logsRef = db.collection('UserLogs');
      logsRef.get().then(snapshot => {
        let logsHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          logsHTML += `<p>${data.activity} by ${data.username} at ${new Date(data.timestamp).toLocaleString()}</p>`;
        });
        document.getElementById('user-logs').innerHTML = logsHTML;
        document.getElementById('logs-count').textContent = snapshot.size;
      });
    }

    // Fetching Approved Users
    function fetchApprovedUsers() {
      const approvedUsersRef = db.collection('Users').where('isApproved', '==', true);
      approvedUsersRef.get().then(snapshot => {
        let approvedUsersHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          approvedUsersHTML += `<p>${data.username} (${data.email}) 
                                  <button class="button" onclick="blockUser('${doc.id}')">Block</button>
                                  <button class="button" onclick="holdUser('${doc.id}')">Hold</button>
                                  <button class="button" onclick="removeUser('${doc.id}')">Remove</button>
                                 </p>`;
        });
        document.getElementById('approved-users').innerHTML = approvedUsersHTML;
        document.getElementById('approved-count').textContent = snapshot.size;
      });
    }

    // Fetching Hold/Blocked Users
    function fetchBlockedUsers() {
      const blockedUsersRef = db.collection('Users').where('status', 'in', ['Hold', 'Blocked']);
      blockedUsersRef.get().then(snapshot => {
        let blockedUsersHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          blockedUsersHTML += `<p>${data.username} (${data.email}) - ${data.status}
                                <button class="button" onclick="unblockUser('${doc.id}')">Unblock</button>
                                <button class="button" onclick="unholdUser('${doc.id}')">Unhold</button>
                               </p>`;
        });
        document.getElementById('blocked-users').innerHTML = blockedUsersHTML;
        document.getElementById('blocked-count').textContent = snapshot.size;
      });
    }

    // Blocking User
    function blockUser(userId) {
      db.collection('Users').doc(userId).update({
        status: 'Blocked'
      }).then(() => {
        alert('User has been blocked');
        fetchApprovedUsers(); // Refresh approved users
        fetchBlockedUsers(); // Refresh blocked users
      });
    }

    // Holding User
    function holdUser(userId) {
      db.collection('Users').doc(userId).update({
        status: 'Hold'
      }).then(() => {
        alert('User is on hold');
        fetchApprovedUsers(); // Refresh approved users
        fetchBlockedUsers(); // Refresh blocked users
      });
    }

    // Removing User
    function removeUser(userId) {
      db.collection('Users').doc(userId).delete().then(() => {
        alert('User removed');
        fetchApprovedUsers(); // Refresh approved users
      });
    }

    // Unblocking User
    function unblockUser(userId) {
      db.collection('Users').doc(userId).update({
        status: ''
      }).then(() => {
        alert('User has been unblocked');
        fetchBlockedUsers(); // Refresh blocked users
      });
    }

    // Unholding User
    function unholdUser(userId) {
      db.collection('Users').doc(userId).update({
        status: ''
      }).then(() => {
        alert('User has been removed from hold');
        fetchBlockedUsers(); // Refresh blocked users
      });
    }

    // Clear Logs
    document.getElementById('clear-logs').addEventListener('click', () => {
      db.collection('UserLogs').get().then(snapshot => {
        snapshot.forEach(doc => {
          doc.ref.delete();
        });
        alert('Logs cleared');
        fetchUserLogs(); // Refresh logs
      });
    });

    // Load all data when page loads
    window.onload = () => {
      fetchOnlineUsers();
      fetchUserLogs();
      fetchApprovedUsers();
      fetchBlockedUsers();
    };
  </script>
</body>
</html>