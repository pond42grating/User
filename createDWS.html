<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create DWS Entry</title>
</head>
<body>
  <h2>Create and View DWS Entry</h2>
  
  <!-- Form to Add DWS Entry -->
  <div>
    <input type="text" id="dwsID" placeholder="DWS ID">
    <input type="text" id="dwsName" placeholder="DWS Name">
    <button onclick="addDWSEntry()">Add Entry</button>
  </div>

  <br>

  <!-- Button to Read Entries -->
  <div>
    <button onclick="getDWSEntries()">View All Entries</button>
    <ul id="dwsList"></ul>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getFirestore, doc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAXZgxM6PU-T3D2811KnBszblRWju7rv1Y",
      authDomain: "dws-management.firebaseapp.com",
      projectId: "dws-management",
      storageBucket: "dws-management.appspot.com",
      messagingSenderId: "23827231923",
      appId: "1:23827231923:web:97141b6d19c7cd109d2cc6",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Function to Add a DWS Entry
    async function addDWSEntry() {
      const dwsID = document.getElementById("dwsID").value.trim();
      const dwsName = document.getElementById("dwsName").value.trim();

      if (!dwsID || !dwsName) {
        alert("Please provide both DWS ID and Name.");
        return;
      }

      try {
        const dwsDocRef = doc(db, "DWS", dwsID); // Create/Update a document in "DWS" collection
        await setDoc(dwsDocRef, { name: dwsName }, { merge: true }); // Merge data to avoid overwriting
        alert("DWS Entry Added!");
      } catch (error) {
        console.error("Error adding DWS entry:", error);
        alert("Error: " + error.message);
      }
    }

    // Function to Read All DWS Entries
    async function getDWSEntries() {
      try {
        const dwsCollectionRef = collection(db, "DWS"); // Reference the "DWS" collection
        const querySnapshot = await getDocs(dwsCollectionRef); // Fetch all documents

        const dwsList = document.getElementById("dwsList");
        dwsList.innerHTML = ""; // Clear the list

        querySnapshot.forEach((doc) => {
          const listItem = document.createElement("li");
          listItem.textContent = `ID: ${doc.id}, Name: ${doc.data().name}`;
          dwsList.appendChild(listItem);
        });
      } catch (error) {
        console.error("Error fetching DWS entries:", error);
        alert("Error: " + error.message);
      }
    }

    // Export functions to global scope
    window.addDWSEntry = addDWSEntry;
    window.getDWSEntries = getDWSEntries;
  </script>
</body>
</html>